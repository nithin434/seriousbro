<!DOCTYPE html>
<html>
<head>
    <title>Resume - {{ resume_data.parsed_data.personal_info.name if resume_data.parsed_data.personal_info.name else 'Resume View' }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .resume-container {
            max-width: 850px;
            margin: 0 auto;
            background: white;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            min-height: 11in;
        }
        
        .resume-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            text-align: center;
        }
        
        .resume-content {
            padding: 2rem;
        }
        
        .section-title {
            font-size: 1.2rem;
            font-weight: bold;
            color: #333;
            border-bottom: 2px solid #667eea;
            padding-bottom: 0.5rem;
            margin-bottom: 1rem;
            margin-top: 2rem;
        }
        
        .section-title:first-child {
            margin-top: 0;
        }
        
        .experience-item, .education-item, .project-item {
            margin-bottom: 1.5rem;
            padding: 1rem;
            border-left: 3px solid #667eea;
            background: #f8f9fa;
        }
        
        .job-title, .degree-title, .project-title {
            font-weight: bold;
            color: #333;
            font-size: 1.1rem;
        }
        
        .company-name, .school-name {
            color: #667eea;
            font-weight: 600;
        }
        
        .date-range {
            color: #666;
            font-style: italic;
            float: right;
        }
        
        .skills-container {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .skill-tag {
            background: #667eea;
            color: white;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.85rem;
        }
        
        .contact-info {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }
        
        .contact-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: rgba(255,255,255,0.9);
        }
        
        .responsibilities {
            margin-top: 0.5rem;
        }
        
        .responsibilities ul {
            margin: 0;
            padding-left: 1.2rem;
        }
        
        .responsibilities li {
            margin-bottom: 0.3rem;
            line-height: 1.4;
        }
        
        .summary-text {
            font-style: italic;
            color: #555;
            line-height: 1.6;
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        
        .rotate-90 { 
            transform: rotate(90deg); 
        }
        
        .transition-transform { 
            transition: transform 0.2s ease-in-out; 
        }
        
        @media print {
            .no-print {
                display: none !important;
            }
            
            .resume-container {
                box-shadow: none;
                margin: 0;
                max-width: none;
            }
            
            body {
                margin: 0;
                padding: 0;
            }
        }
        
        .certification-item {
            background: #e8f5e8;
            border-left: 3px solid #28a745;
            padding: 0.8rem;
            margin-bottom: 0.8rem;
            border-radius: 4px;
        }
        
        .cert-name {
            font-weight: bold;
            color: #155724;
        }
        
        .cert-issuer {
            color: #28a745;
            font-size: 0.9rem;
        }
        
        .project-tech {
            margin-top: 0.5rem;
        }
        
        .tech-tag {
            background: #ffeaa7;
            color: #2d3436;
            padding: 0.2rem 0.6rem;
            border-radius: 15px;
            font-size: 0.8rem;
            margin-right: 0.5rem;
            margin-bottom: 0.3rem;
            display: inline-block;
        }
    </style>
</head>
<body class="bg-light">
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary no-print">
        <div class="container">
            <a class="navbar-brand" href="/">Resume AI</a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/dashboard/{{ resume_data._id }}">Back to Dashboard</a>
                <button class="btn btn-outline-light ms-2" onclick="window.print()">
                    <i class="fas fa-print me-1"></i>Print Resume
                </button>
            </div>
        </div>
    </nav>

    <div class="container mt-4 no-print">
        <!-- Debug Info Section -->
        <div class="card mb-4">
            <div class="card-header bg-light" style="cursor: pointer;" onclick="toggleDebug()">
                <div class="d-flex align-items-center">
                    <i id="debugArrow" class="fas fa-chevron-right me-2 transition-transform"></i>
                    <small class="text-muted">Debug Info (Resume Data)</small>
                </div>
            </div>
            <div id="debugContent" class="card-body" style="display: none;">
                <pre class="bg-dark text-success p-3 rounded small" style="max-height: 400px; overflow-y: auto;">{{ resume_data | tojson(indent=2) }}</pre>
            </div>
        </div>
    </div>

    <!-- Resume Display -->
    <div class="container mt-4">
        <div class="resume-container">
            {% set parsed = resume_data.parsed_data %}
            
            <!-- Header Section -->
            <div class="resume-header">
                <h1 class="mb-2">{{ parsed.personal_info.name or 'Your Name' }}</h1>
                
                <div class="contact-info">
                    {% if parsed.personal_info.email %}
                    <div class="contact-item">
                        <i class="fas fa-envelope"></i>
                        <span>{{ parsed.personal_info.email }}</span>
                    </div>
                    {% endif %}
                    
                    {% if parsed.personal_info.phone %}
                    <div class="contact-item">
                        <i class="fas fa-phone"></i>
                        <span>{{ parsed.personal_info.phone }}</span>
                    </div>
                    {% endif %}
                    
                    {% if parsed.personal_info.location %}
                    <div class="contact-item">
                        <i class="fas fa-map-marker-alt"></i>
                        <span>{{ parsed.personal_info.location }}</span>
                    </div>
                    {% endif %}
                    
                    {% if parsed.personal_info.linkedin %}
                    <div class="contact-item">
                        <i class="fab fa-linkedin"></i>
                        <span>{{ parsed.personal_info.linkedin }}</span>
                    </div>
                    {% endif %}
                    
                    {% if parsed.personal_info.github %}
                    <div class="contact-item">
                        <i class="fab fa-github"></i>
                        <span>{{ parsed.personal_info.github }}</span>
                    </div>
                    {% endif %}
                </div>
            </div>

            <div class="resume-content">
                <!-- Professional Summary -->
                {% if parsed.professional_summary or parsed.objective %}
                <div class="section-title">
                    <i class="fas fa-user me-2"></i>Professional Summary
                </div>
                <div class="summary-text">
                    {% set summary_text = parsed.professional_summary or parsed.objective %}
                    {% if summary_text %}
                        {% if summary_text is string %}
                            {{ summary_text }}
                        {% elif summary_text is iterable %}
                            {{ summary_text | join(' ') }}
                        {% endif %}
                    {% else %}
                        Professional summary not available.
                    {% endif %}
                </div>
                {% endif %}

                <!-- Experience Section -->
                {% if parsed.experience and parsed.experience|length > 0 %}
                <div class="section-title">
                    <i class="fas fa-briefcase me-2"></i>Professional Experience
                </div>
                
                {% for exp in parsed.experience %}
                <div class="experience-item">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <div class="job-title">{{ exp.title or exp.position or 'Position Title' }}</div>
                            <div class="company-name">{{ exp.company or 'Company Name' }}</div>
                            {% if exp.location %}
                            <div class="text-muted small">
                                <i class="fas fa-map-marker-alt me-1"></i>{{ exp.location }}
                            </div>
                            {% endif %}
                        </div>
                        {% if exp.duration or exp.start_date %}
                        <div class="date-range">
                            {{ exp.duration or (exp.start_date + ' - ' + (exp.end_date or 'Present')) }}
                        </div>
                        {% endif %}
                    </div>
                    
                    {% if exp.responsibilities or exp.description or exp.achievements %}
                    <div class="responsibilities">
                        {% if exp.responsibilities %}
                            {% if exp.responsibilities is string %}
                                <p>{{ exp.responsibilities }}</p>
                            {% elif exp.responsibilities is iterable and exp.responsibilities %}
                                <ul>
                                    {% for resp in exp.responsibilities %}
                                        {% if resp %}
                                            <li>{{ resp }}</li>
                                        {% endif %}
                                    {% endfor %}
                                </ul>
                            {% endif %}
                        {% elif exp.description %}
                            <p>{{ exp.description }}</p>
                        {% endif %}
                        
                        {% if exp.achievements and exp.achievements is iterable %}
                        <div class="mt-2">
                            <strong>Key Achievements:</strong>
                            <ul>
                                {% for achievement in exp.achievements %}
                                    {% if achievement %}
                                        <li>{{ achievement }}</li>
                                    {% endif %}
                                {% endfor %}
                            </ul>
                        </div>
                        {% endif %}
                    </div>
                    {% endif %}
                </div>
                {% endfor %}
                {% endif %}

                <!-- Education Section -->
                {% if parsed.education and parsed.education|length > 0 %}
                <div class="section-title">
                    <i class="fas fa-graduation-cap me-2"></i>Education
                </div>
                
                {% for edu in parsed.education %}
                <div class="education-item">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <div class="degree-title">{{ edu.degree or edu.field_of_study or 'Degree' }}</div>
                            <div class="school-name">{{ edu.institution or edu.school or 'School Name' }}</div>
                            {% if edu.location %}
                            <div class="text-muted small">
                                <i class="fas fa-map-marker-alt me-1"></i>{{ edu.location }}
                            </div>
                            {% endif %}
                            {% if edu.gpa %}
                            <div class="text-muted small">GPA: {{ edu.gpa }}</div>
                            {% endif %}
                        </div>
                        {% if edu.year or edu.graduation_date %}
                        <div class="date-range">
                            {{ edu.year or edu.graduation_date }}
                        </div>
                        {% endif %}
                    </div>
                    
                    {% if edu.relevant_coursework and edu.relevant_coursework is iterable %}
                    <div class="mt-2">
                        <strong>Relevant Coursework:</strong> 
                        {% if edu.relevant_coursework is string %}
                            {{ edu.relevant_coursework }}
                        {% else %}
                            {{ edu.relevant_coursework | join(', ') }}
                        {% endif %}
                    </div>
                    {% endif %}
                    
                    {% if edu.honors and edu.honors is iterable %}
                    <div class="mt-2">
                        <strong>Honors:</strong> {{ edu.honors | join(', ') }}
                    </div>
                    {% endif %}
                </div>
                {% endfor %}
                {% endif %}

                <!-- Skills Section -->
                {% if parsed.skills %}
                <div class="section-title">
                    <i class="fas fa-cogs me-2"></i>Technical Skills
                </div>
                
                <div class="skills-container">
                    {% if parsed.skills is mapping %}
                        {% for category, skill_list in parsed.skills.items() %}
                            {% if skill_list and (skill_list is not string or skill_list.strip()) %}
                            <div class="mb-3 w-100">
                                <strong>{{ category.replace('_', ' ').title() }}:</strong>
                                <div class="skills-container mt-1">
                                    {% if skill_list is iterable and skill_list is not string %}
                                        {% for skill in skill_list %}
                                            {% if skill and skill.strip() %}
                                                <span class="skill-tag">{{ skill }}</span>
                                            {% endif %}
                                        {% endfor %}
                                    {% else %}
                                        <span class="skill-tag">{{ skill_list }}</span>
                                    {% endif %}
                                </div>
                            </div>
                            {% endif %}
                        {% endfor %}
                    {% elif parsed.skills is iterable and parsed.skills is not string %}
                        {% for skill in parsed.skills %}
                            {% if skill and skill.strip() %}
                                <span class="skill-tag">{{ skill }}</span>
                            {% endif %}
                        {% endfor %}
                    {% elif parsed.skills and parsed.skills.strip() %}
                        <span class="skill-tag">{{ parsed.skills }}</span>
                    {% endif %}
                </div>
                {% endif %}

                <!-- Projects Section -->
                {% if parsed.projects and parsed.projects|length > 0 %}
                <div class="section-title">
                    <i class="fas fa-project-diagram me-2"></i>Projects
                </div>
                
                {% for project in parsed.projects %}
                <div class="project-item">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <div class="project-title">{{ project.name or project.title or 'Project Name' }}</div>
                            {% if project.link or project.url or project.github %}
                            <div class="text-muted small">
                                {% if project.url or project.link %}
                                <a href="{{ project.url or project.link }}" target="_blank" class="text-decoration-none">
                                    <i class="fas fa-external-link-alt me-1"></i>Live Demo
                                </a>
                                {% endif %}
                                {% if project.github %}
                                <a href="{{ project.github }}" target="_blank" class="text-decoration-none ms-3">
                                    <i class="fab fa-github me-1"></i>GitHub
                                </a>
                                {% endif %}
                            </div>
                            {% endif %}
                        </div>
                        {% if project.duration or project.date %}
                        <div class="date-range">{{ project.duration or project.date }}</div>
                        {% endif %}
                    </div>
                    
                    {% if project.description %}
                    <div class="mt-2">
                        {% if project.description is iterable and project.description is not string %}
                            <ul>
                                {% for desc in project.description %}
                                    {% if desc and desc.strip() %}
                                        <li>{{ desc }}</li>
                                    {% endif %}
                                {% endfor %}
                            </ul>
                        {% else %}
                            <p>{{ project.description }}</p>
                        {% endif %}
                    </div>
                    {% endif %}
                    
                    {% if project.technologies and project.technologies is iterable %}
                    <div class="project-tech">
                        {% if project.technologies is string %}
                            <span class="tech-tag">{{ project.technologies }}</span>
                        {% else %}
                            {% for tech in project.technologies %}
                                {% if tech and tech.strip() %}
                                    <span class="tech-tag">{{ tech }}</span>
                                {% endif %}
                            {% endfor %}
                        {% endif %}
                    </div>
                    {% endif %}
                    
                    {% if project.achievements and project.achievements is iterable %}
                    <div class="mt-2">
                        <strong>Achievements:</strong>
                        <ul class="small">
                            {% for achievement in project.achievements %}
                                {% if achievement and achievement.strip() %}
                                    <li>{{ achievement }}</li>
                                {% endif %}
                            {% endfor %}
                        </ul>
                    </div>
                    {% endif %}
                </div>
                {% endfor %}
                {% endif %}

                <!-- Certifications Section -->
                {% if parsed.certifications and parsed.certifications|length > 0 %}
                <div class="section-title">
                    <i class="fas fa-certificate me-2"></i>Certifications
                </div>
                
                {% for cert in parsed.certifications %}
                <div class="certification-item">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <div class="cert-name">{{ cert.name or cert.title or 'Certification Name' }}</div>
                            <div class="cert-issuer">{{ cert.issuer or cert.organization or 'Issuing Organization' }}</div>
                        </div>
                        {% if cert.date or cert.year %}
                        <div class="date-range">{{ cert.date or cert.year }}</div>
                        {% endif %}
                    </div>
                    
                    {% if cert.credential_id %}
                    <div class="mt-1 small text-muted">
                        Credential ID: {{ cert.credential_id }}
                    </div>
                    {% endif %}
                </div>
                {% endfor %}
                {% endif %}

                <!-- Additional Sections -->
                {% if parsed.languages and parsed.languages|length > 0 %}
                <div class="section-title">
                    <i class="fas fa-language me-2"></i>Languages
                </div>
                <div class="skills-container">
                    {% for lang in parsed.languages %}
                        {% if lang is mapping %}
                        <span class="skill-tag">{{ lang.name or lang.language }} - {{ lang.proficiency or 'Proficient' }}</span>
                        {% else %}
                        <span class="skill-tag">{{ lang }}</span>
                        {% endif %}
                    {% endfor %}
                </div>
                {% endif %}

                {% if parsed.awards and parsed.awards|length > 0 %}
                <div class="section-title">
                    <i class="fas fa-trophy me-2"></i>Awards & Recognition
                </div>
                {% for award in parsed.awards %}
                <div class="mb-2">
                    <strong>{{ award.name or award.title or award }}</strong>
                    {% if award.year or award.date %}
                    <span class="text-muted"> - {{ award.year or award.date }}</span>
                    {% endif %}
                    {% if award.description %}
                    <div class="text-muted small">{{ award.description }}</div>
                    {% endif %}
                </div>
                {% endfor %}
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Action Buttons -->
    <div class="container mt-4 mb-5 no-print">
        <div class="text-center">
            <a href="/dashboard/{{ resume_data._id }}" class="btn btn-secondary me-3">
                <i class="fas fa-arrow-left me-2"></i>Back to Dashboard
            </a>
            <button onclick="window.print()" class="btn btn-primary me-3">
                <i class="fas fa-print me-2"></i>Print Resume
            </button>
            <a href="/edit-resume/{{ resume_data._id }}" class="btn btn-warning">
                <i class="fas fa-edit me-2"></i>Edit Resume
            </a>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function toggleDebug() {
            const debugContent = document.getElementById('debugContent');
            const debugArrow = document.getElementById('debugArrow');
            
            if (debugContent.style.display === 'none') {
                debugContent.style.display = 'block';
                debugArrow.classList.add('rotate-90');
            } else {
                debugContent.style.display = 'none';
                debugArrow.classList.remove('rotate-90');
            }
        }

        // Add smooth scrolling for better UX
        document.addEventListener('DOMContentLoaded', function() {
            // Auto-hide debug section after 5 seconds
            setTimeout(() => {
                const debugContent = document.getElementById('debugContent');
                if (debugContent && debugContent.style.display !== 'none') {
                    toggleDebug();
                }
            }, 5000);
        });

        // Print optimization
        window.addEventListener('beforeprint', function() {
            // Hide any tooltips or dropdowns before printing
            document.querySelectorAll('.tooltip, .dropdown-menu').forEach(el => {
                el.style.display = 'none';
            });
        });
    </script>
</body>
</html>