# Ensure Apache listens on port 5000 (defined in ports.conf)
# Listen 5000

<VirtualHost *:5000>
    ServerName syntexa.app
    ServerAlias www.syntexa.app

    # Redirect HTTP to HTTPS (enable after setting up SSL)
    # RewriteEngine On
    # RewriteCond %{HTTPS} off
    # RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

    # WSGI configuration
    WSGIDaemonProcess syntexa python-home=/home/clouduser/GEt/venv python-path=/home/clouduser/GEt
    WSGIProcessGroup syntexa
    WSGIScriptAlias / /home/clouduser/GEt/wsgi.py
    WSGIApplicationGroup %{GLOBAL}
    
    # Static files configuration - serve uploads directly with Apache
    Alias /uploads /home/clouduser/GEt/uploads
    <Directory /home/clouduser/GEt/uploads>
        Require all granted
        Options Indexes FollowSymLinks
        AllowOverride None
        Order allow,deny
        Allow from all
    </Directory>

    # Static files configuration - serve other static files
    Alias /static /home/clouduser/GEt/static
    <Directory /home/clouduser/GEt/static>
        Require all granted
        Options Indexes FollowSymLinks
        AllowOverride None
        Order allow,deny
        Allow from all
    </Directory>

    # Directory permissions for main application
    <Directory /home/clouduser/GEt>
        Require all granted
    </Directory>

    # Logging
    ErrorLog ${APACHE_LOG_DIR}/syntexa_error.log
    CustomLog ${APACHE_LOG_DIR}/syntexa_access.log combined
   # RewriteEngine on
   # RewriteCond %{SERVER_NAME} =syntexa.app [OR]
   # RewriteCond %{SERVER_NAME} =www.syntexa.app
   # RewriteRule ^ https://%{SERVER_NAME}%{REQUEST_URI} [END,NE,R=permanent]
</VirtualHost>

<VirtualHost *:443>
    ServerName syntexa.app
    ServerAlias www.syntexa.app

    # WSGI configuration
    WSGIDaemonProcess syntexa43 python-home=/home/clouduser/GEt/venv python-path=/home/clouduser/GEt
    WSGIProcessGroup syntexa43
    WSGIScriptAlias / /home/clouduser/GEt/wsgi.py
    WSGIApplicationGroup %{GLOBAL}
    
    # SSL configuration (uncomment after setting up Let's Encrypt)
    SSLEngine On
    SSLCertificateFile /etc/letsencrypt/live/syntexa.app/fullchain.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/syntexa.app/privkey.pem
    
    # Static files configuration - serve uploads directly with Apache
    Alias /uploads /home/clouduser/GEt/uploads
    <Directory /home/clouduser/GEt/uploads>
        Require all granted
        Options Indexes FollowSymLinks
        AllowOverride None
        Order allow,deny
        Allow from all
    </Directory>

    # Static files configuration - serve other static files
    Alias /static /home/clouduser/GEt/static
    <Directory /home/clouduser/GEt/static>
        Require all granted
        Options Indexes FollowSymLinks
        AllowOverride None
        Order allow,deny
        Allow from all
    </Directory>

    # Directory permissions for main application
    <Directory /home/clouduser/GEt>
        Require all granted
    </Directory>

    # Logging
    ErrorLog ${APACHE_LOG_DIR}/syntexa_error.log
    CustomLog ${APACHE_LOG_DIR}/syntexa_access.log combined

    # Security headers
    Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains"
    #Include /etc/letsencrypt/options-ssl-apache.conf
    #SSLCertificateFile /etc/letsencrypt/live/syntexa.app/fullchain.pem
    #SSLCertificateKeyFile /etc/letsencrypt/live/syntexa.app/privkey.pem
</VirtualHost>